# JVM运行原理

当我们运行Java代码，JVM的处理流程主要如下：

1. **JVM 向操作系统申请内存**。操作系统通过JVM配置参数的内存大小找到具体的内存分配表，然后将内存段的起始地址和终止地址分配给JVM。之后交由JVM内部进行分配。
2. **分配堆、栈以及方法区的内存大小**。JVM获得内存空间后，根据配置参数进行分配。
3. **class文件的加载、链接（验证、准备以及解析）**。在准备阶段会为静态变量分配内存，初始化系统的初始值（不是我们代码指定的初始值）。
4. **初始化：执行构造器`<clinit>`**。编译器在将`.java`编译成`.class`时，会收集所有类的初始化代码（`静态变量赋值语句`、`静态代码块`、`静态方法`），生成`<clinit>`方法
5. **执行main方法**。执行main线程的main方法，启动程序。

## JVM如何执行一个类

> 当多个线程访问方法区的同一个类时，若这个类未被JVM加载，此时仅允许一个线程执行加载，其余线程必须等待。

JVM执行一个类时，必须经过加载、连接、初始化。连接又包括验证、准备、解析三个阶段。

在加载类时，JVM会先加载class文件。

待加载到内存中后，JVM会将class文件常量池中的内容存放到运行时常量池中。

在解析阶段，JVM将符号引用替换为直接引用（对象的索引值）。