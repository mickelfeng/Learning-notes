# Web服务器



## Apache



## Nginx

Nginx是一个 轻量级的Web服务器，CPU、内存占用都非常少。

Nginx 采用 **进程池 + 单线程**	的工作模式。消除了进程/线程创建和切换的成本。

* 预先创建固定数量的**worker进程**组成**进程池**，之后就不在fork新进程了。
* 自动把**进程绑定到独立的CPU**上，发挥多核性能。
* 为了摆脱外部依赖，Nginx自行实现了master进程。并由**master进程来管理进程池**。负责监控并恢复异常的Worker进程，保证服务的稳定性。

> Web服务器主要是 **I/O密集型**，关键在于网络收发而不是CPU计算。网络IO网络会出现大量的等待（等待对端响应、等待数据到达等）导致CPU空闲。所以Nginx利用 **I/O多路复用接口（ `epoll`） ,** 即使是单线程在处理能力上也超越了其他很多 多线程的服务器。

### 阶段式处理（流水线）

> Nginx使用的是静态配置文件，所以每次修改配置必须要重启。后续引入了 JavaScript，实现了一定程度的动态化。

Nginx 支持通过模块配置的方式进行任意组合，具有很高的扩展性，十分灵活。

Nginx 使用 责任链模式，以流水线的方式各个模块。



### Nginx HTTP配置

HTTP处理主要包括四大类模块：

* **handler**：直接**处理 HTTP 请求**；
* **filter**：不直接处理请求，而是**加工过滤响应报文**；
* **upstream**：实现**反向代理**功能，**转发请求**到其他服务器；
* **balance**：实现**反向代理时的负载均衡算法**。

## OpenResty

OpenResty 基于 Nginx，并利用Lua 进行了增加。

* 动态配置：依靠Lua 的代码热加载，不需要重启就能更新配置。
* 多路复用：Nginx基于系统级别的多路复用 epoll，OpenResty基于Lua的协程的同步非阻塞特性，实现了应用层级别的多路复用，消耗的资源更少。
* 阶段式处理：Nginx的流水线由一个个C模块构成，OpenResty的流水线则是由 一个个 Lua脚本构成。